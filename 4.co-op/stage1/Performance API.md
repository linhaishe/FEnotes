# Performance API

Performance APIï¼ˆæ€§èƒ½APIï¼‰æ˜¯ä¸€ç§Web APIï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜æµ‹é‡å’Œåˆ†æWebåº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œä¾‹å¦‚åŠ è½½æ—¶é—´ã€å“åº”æ—¶é—´ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ç­‰ã€‚å®ƒæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„Webå¹³å°APIçš„ä¸€éƒ¨åˆ†ã€‚


## Performance API æ¦‚è¿°

### 1. Performance å¯¹è±¡

> window.performance æ˜¯W3Cæ€§èƒ½å°ç»„å¼•å…¥çš„æ–°çš„APIï¼Œç›®å‰IE9ä»¥ä¸Šçš„æµè§ˆå™¨éƒ½æ”¯æŒã€‚

<img src="https://raw.githubusercontent.com/linhaishe/blogImageBackup/main/performance-api/image-20230403214549741.png" style="zoom:50%;" />

ä¸€ä¸ªperformanceå¯¹è±¡çš„å®Œæ•´ç»“æ„åŒ…æ‹¬ï¼š

1. memoryå­—æ®µä»£è¡¨JavaScriptå¯¹å†…å­˜çš„å ç”¨ã€‚
2. navigationå­—æ®µç»Ÿè®¡çš„æ˜¯ä¸€äº›ç½‘é¡µå¯¼èˆªç›¸å…³çš„æ•°æ®ï¼š
3. redirectCount:é‡å®šå‘çš„æ•°é‡ï¼ˆåªè¯»ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£æœ‰åŒæºç­–ç•¥é™åˆ¶ï¼Œå³ä»…èƒ½æ£€æµ‹åŒæºçš„é‡å®šå‘ï¼›
4. type è¿”å›å€¼åº”è¯¥æ˜¯0,1,2 ä¸­çš„ä¸€ä¸ªã€‚åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªæšä¸¾å€¼:
   - 0 : TYPE_NAVIGATE (ç”¨æˆ·é€šè¿‡å¸¸è§„å¯¼èˆªæ–¹å¼è®¿é—®é¡µé¢ï¼Œæ¯”å¦‚ç‚¹ä¸€ä¸ªé“¾æ¥ï¼Œæˆ–è€…ä¸€èˆ¬çš„getæ–¹å¼)
   - 1 : TYPE_RELOAD (ç”¨æˆ·é€šè¿‡åˆ·æ–°ï¼ŒåŒ…æ‹¬JSè°ƒç”¨åˆ·æ–°æ¥å£ç­‰æ–¹å¼è®¿é—®é¡µé¢)
   - 2 : TYPE_BACK_FORWARD (ç”¨æˆ·é€šè¿‡åé€€æŒ‰é’®è®¿é—®æœ¬é¡µé¢) æœ€é‡è¦çš„æ˜¯timingå­—æ®µçš„ç»Ÿè®¡æ•°æ®ï¼Œå®ƒåŒ…å«äº†ç½‘ç»œã€è§£æç­‰ä¸€ç³»åˆ—çš„æ—¶é—´æ•°æ®ã€‚

### 2. performance.timing å¯¹è±¡

#### ç®€ä»‹

> ğŸš®**å·²å¼ƒç”¨:** ä¸å†æ¨èä½¿ç”¨è¯¥ç‰¹æ€§ã€‚è™½ç„¶ä¸€äº›æµè§ˆå™¨ä»ç„¶æ”¯æŒå®ƒï¼Œä½†ä¹Ÿè®¸å·²ä»ç›¸å…³çš„ web æ ‡å‡†ä¸­ç§»é™¤ï¼Œä¹Ÿè®¸æ­£å‡†å¤‡ç§»é™¤æˆ–å‡ºäºå…¼å®¹æ€§è€Œä¿ç•™ã€‚è¯·å°½é‡ä¸è¦ä½¿ç”¨è¯¥ç‰¹æ€§ï¼Œå¹¶æ›´æ–°ç°æœ‰çš„ä»£ç ï¼›

> âš ï¸**è­¦å‘Šï¼š** è¯¥å±æ€§åœ¨ [Navigation Timing Level 2 specification](https://w3c.github.io/navigation-timing/#obsolete) ä¸­å·²ç»è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ [`PerformanceNavigationTiming`](https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceNavigationTiming) æ›¿ä»£ã€‚

`PerformanceTiming` è¢«åºŸå¼ƒäº†ï¼Œå®ƒçš„æ›¿ä»£å¯¹è±¡æ˜¯ `PerformanceEntry` å’Œ `PerformanceResourceTiming` æ¥å£ã€‚è¿™ä¸¤ä¸ªæ¥å£æä¾›äº†ä¸ `PerformanceTiming` ç›¸ä¼¼çš„ä¿¡æ¯ï¼Œä½†ä½¿ç”¨æ›´åŠ çµæ´»å’Œæ ‡å‡†åŒ–ã€‚

- `PerformanceEntry` æ¥å£æä¾›äº†è®¸å¤šä¸æ€§èƒ½ç›¸å…³çš„æ•°æ®ï¼Œå¦‚å¯åŠ¨æ—¶é—´ã€ç»“æŸæ—¶é—´ã€æŒç»­æ—¶é—´å’Œåç§°ç­‰ã€‚
- `PerformanceResourceTiming` æ¥å£ç»§æ‰¿è‡ª `PerformanceEntry` æ¥å£ï¼Œæä¾›äº†æ›´å¤šå…³äºç½‘ç»œèµ„æºè¯·æ±‚å’Œå“åº”çš„ä¿¡æ¯ï¼Œå¦‚ DNS æŸ¥è¯¢ã€TCP è¿æ¥ã€SSL/TLS æ¡æ‰‹ã€HTTP è¯·æ±‚å’Œå“åº”ç­‰ã€‚

è¿™äº›æ–°çš„æ¥å£æä¾›äº†æ›´åŠ å‡†ç¡®å’Œå¯é çš„æ€§èƒ½ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒè·¨å¹³å°å’Œè·¨æµè§ˆå™¨çš„ä½¿ç”¨ã€‚

------

#### timingçš„æ•´ä½“ç»“æ„

å®ƒæä¾›äº†å…³äºé¡µé¢åŠ è½½å’Œæ¸²æŸ“æ—¶é—´çš„è¯¦ç»†ä¿¡æ¯ã€‚å®ƒåŒ…å«äº†ä¸é¡µé¢ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å„ç§æ—¶é—´æˆ³ï¼Œè¿™äº›æ—¶é—´æˆ³å¯ä»¥ç”¨æ¥æµ‹é‡é¡µé¢åŠ è½½çš„å„ä¸ªé˜¶æ®µä»¥åŠç”¨æˆ·ä½“éªŒã€‚

![image-20230403214930561](https://raw.githubusercontent.com/linhaishe/blogImageBackup/main/performance-api/image-20230403214930561.png)

1. `startTime`ï¼šæœ‰äº›æµè§ˆå™¨å®ç°ä¸º`navigationStart`ã€‚è¯¥å±æ€§è¿”å›æµè§ˆå™¨å¼€å§‹å¯¼èˆªçš„æ—¶é—´æˆ³ï¼Œé€šå¸¸æ˜¯ç”¨æˆ·è¾“å…¥ç½‘å€æˆ–ç‚¹å‡»é“¾æ¥çš„æ—¶é—´ã€‚å¦‚æœå½“å‰æ–‡æ¡£ä¸ºç©ºï¼Œåˆ™`navigationStart`çš„å€¼ç­‰äº`fetchStart`ã€‚
2. `redirectStart`å’Œr`edirectEnd`ï¼šå¦‚æœé¡µé¢æ˜¯ç”±`redirect`è€Œæ¥ï¼Œåˆ™`redirectStart`å’Œ`redirectEnd`åˆ†åˆ«ä»£è¡¨`redirect`å¼€å§‹å’Œç»“æŸçš„æ—¶é—´èŠ‚ç‚¹
3. `unloadEventStart`å’Œu`nloadEventEnd`ï¼šå¦‚æœå‰ä¸€ä¸ªæ–‡æ¡£å’Œè¯·æ±‚çš„æ–‡æ¡£æ˜¯åŒä¸€ä¸ªåŸŸçš„ï¼Œåˆ™`unloadEventStart`å’Œ`unloadEventEnd`åˆ†åˆ«ä»£è¡¨æµè§ˆå™¨`unload`å‰ä¸€ä¸ªæ–‡æ¡£çš„å¼€å§‹å’Œç»“æŸæ—¶é—´èŠ‚ç‚¹ã€‚å¦åˆ™ä¸¤è€…éƒ½ç­‰äº0
4. `fetchStart`æ˜¯æŒ‡åœ¨æµè§ˆå™¨å‘èµ·ä»»ä½•è¯·æ±‚ä¹‹å‰çš„æ—¶é—´å€¼ã€‚åœ¨`fetchStart`å’Œ`domainLookupStart`ä¹‹é—´ï¼Œæµè§ˆå™¨ä¼šæ£€æŸ¥å½“å‰æ–‡æ¡£çš„ç¼“å­˜
5. `domainLookupStart`å’Œ`domainLookupEnd`åˆ†åˆ«ä»£è¡¨DNSæŸ¥è¯¢çš„å¼€å§‹å’Œç»“æŸæ—¶é—´èŠ‚ç‚¹ã€‚å¦‚æœæµè§ˆå™¨æ²¡æœ‰è¿›è¡ŒDNSæŸ¥è¯¢ï¼ˆæ¯”å¦‚ä½¿ç”¨äº†cacheï¼‰ï¼Œåˆ™ä¸¤è€…çš„å€¼éƒ½ç­‰äºfetchStart
6. `connectStart`å’Œ`connectEnd`åˆ†åˆ«ä»£è¡¨TCPå»ºç«‹è¿æ¥å’Œè¿æ¥æˆåŠŸçš„æ—¶é—´èŠ‚ç‚¹ã€‚å¦‚æœæµè§ˆå™¨æ²¡æœ‰è¿›è¡ŒTCPè¿æ¥ï¼ˆæ¯”å¦‚ä½¿ç”¨æŒä¹…åŒ–è¿æ¥`webscoket`ï¼‰ï¼Œåˆ™ä¸¤è€…éƒ½ç­‰äº`domainLookupEnd`ï¼›
7. `secureConnectionStart`ï¼šå¯é€‰ã€‚å¦‚æœé¡µé¢ä½¿ç”¨HTTPSï¼Œå®ƒçš„å€¼æ˜¯å®‰å…¨è¿æ¥æ¡æ‰‹ä¹‹å‰çš„æ—¶åˆ»ã€‚å¦‚æœè¯¥å±æ€§ä¸å¯ç”¨ï¼Œåˆ™è¿”å›`undefined`ã€‚å¦‚æœè¯¥å±æ€§å¯ç”¨ï¼Œä½†æ²¡æœ‰ä½¿ç”¨HTTPSï¼Œåˆ™è¿”å›0ï¼›
8. `requestStart`ä»£è¡¨æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„æ—¶é—´èŠ‚ç‚¹ï¼Œè¯·æ±‚çš„æ–¹å¼å¯ä»¥æ˜¯è¯·æ±‚æœåŠ¡å™¨ã€ç¼“å­˜ã€æœ¬åœ°èµ„æºç­‰ï¼›
9. `responseStart`å’Œ`responseEnd`åˆ†åˆ«ä»£è¡¨æµè§ˆå™¨æ”¶åˆ°ä»æœåŠ¡å™¨ç«¯ï¼ˆæˆ–ç¼“å­˜ã€æœ¬åœ°èµ„æºï¼‰å“åº”å›çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å’Œæœ€åä¸€ä¸ªå­—èŠ‚æ•°æ®çš„æ—¶åˆ»ï¼›
10. `domLoading`ä»£è¡¨æµè§ˆå™¨å¼€å§‹è§£æhtmlæ–‡æ¡£çš„æ—¶é—´èŠ‚ç‚¹ã€‚æˆ‘ä»¬çŸ¥é“IEæµè§ˆå™¨ä¸‹çš„`document`æœ‰`readyState`å±æ€§ï¼Œ`domLoading`çš„å€¼å°±ç­‰äº`readyState`æ”¹å˜ä¸º`loading`çš„æ—¶é—´èŠ‚ç‚¹ï¼›
11. `domInteractive`ä»£è¡¨æµè§ˆå™¨è§£æhtmlæ–‡æ¡£çš„çŠ¶æ€ä¸º`interactive`æ—¶çš„æ—¶é—´èŠ‚ç‚¹ã€‚`domInteractive`å¹¶é`DOMReady`ï¼Œå®ƒæ—©äº`DOMReady`è§¦å‘ï¼Œä»£è¡¨htmlæ–‡æ¡£è§£æå®Œæ¯•ï¼ˆå³dom treeåˆ›å»ºå®Œæˆï¼‰ä½†æ˜¯å†…åµŒèµ„æºï¼ˆæ¯”å¦‚å¤–é“¾cssã€jsç­‰ï¼‰è¿˜æœªåŠ è½½çš„æ—¶é—´ç‚¹ï¼›
12. `domContentLoadedEventStart`ï¼šä»£è¡¨`DOMContentLoaded`äº‹ä»¶è§¦å‘çš„æ—¶é—´èŠ‚ç‚¹ï¼š
13. é¡µé¢æ–‡æ¡£å®Œå…¨åŠ è½½å¹¶è§£æå®Œæ¯•ä¹‹å,ä¼šè§¦å‘`DOMContentLoaded`äº‹ä»¶ï¼ŒHTMLæ–‡æ¡£ä¸ä¼šç­‰å¾…æ ·å¼æ–‡ä»¶,å›¾ç‰‡æ–‡ä»¶,å­æ¡†æ¶é¡µé¢çš„åŠ è½½(loadäº‹ä»¶å¯ä»¥ç”¨æ¥æ£€æµ‹HTMLé¡µé¢æ˜¯å¦å®Œå…¨åŠ è½½å®Œæ¯•(fully-loaded))ã€‚
14. `domContentLoadedEventEnd`ï¼šä»£è¡¨`DOMContentLoaded`äº‹ä»¶å®Œæˆçš„æ—¶é—´èŠ‚ç‚¹ï¼Œæ­¤åˆ»ç”¨æˆ·å¯ä»¥å¯¹é¡µé¢è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±æ˜¯jQueryä¸­çš„domreadyæ—¶é—´ï¼›
15. `domComplete`ï¼šhtmlæ–‡æ¡£å®Œå…¨è§£æå®Œæ¯•çš„æ—¶é—´èŠ‚ç‚¹ï¼›
16. `loadEventStartå’ŒloadEventEnd`åˆ†åˆ«ä»£è¡¨onloadäº‹ä»¶è§¦å‘å’Œç»“æŸçš„æ—¶é—´èŠ‚ç‚¹

---------

#### ä½¿ç”¨æ³¨æ„âš ï¸

1. æµè§ˆå™¨å…¼å®¹æ€§ï¼šä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒperformance.timingæ¥å£ï¼Œå› æ­¤éœ€è¦å…ˆæ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯¥æ¥å£ã€‚åŒæ—¶ï¼Œä¸åŒæµè§ˆå™¨çš„æ€§èƒ½ç›‘æµ‹æ–¹å¼å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå¯èƒ½éœ€è¦å¯¹ä¸åŒæµè§ˆå™¨è¿›è¡Œç‰¹åˆ«å¤„ç†ã€‚
2. å—å…¶ä»–å› ç´ å½±å“ï¼šé¡µé¢åŠ è½½æ—¶é—´å—åˆ°å¾ˆå¤šå› ç´ çš„å½±å“ï¼Œæ¯”å¦‚ç½‘ç»œé€Ÿåº¦ã€æœåŠ¡å™¨å“åº”æ—¶é—´ã€ç¼“å­˜æƒ…å†µç­‰ç­‰ã€‚å› æ­¤ï¼Œé€šè¿‡è®¡ç®—çš„æ—¶é—´æˆ³ä¹‹å·®ï¼Œå¾—å‡ºçš„åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œå¯èƒ½å­˜åœ¨è¯¯å·®ã€‚
3. DOMæ“ä½œï¼šè®¡ç®— `loadEventEnd` å’Œ `navigationStart` çš„æ—¶é—´æˆ³ä¹‹å·®å¹¶ä¸åŒ…æ‹¬DOMæ“ä½œæ—¶é—´ã€‚å¦‚æœé¡µé¢ä¸­å­˜åœ¨å¤§é‡çš„DOMæ“ä½œï¼Œéœ€è¦è€ƒè™‘è¿™éƒ¨åˆ†æ—¶é—´å¯¹é¡µé¢åŠ è½½æ—¶é—´çš„å½±å“ï¼Œå¹¶åœ¨è®¡ç®—æ—¶è¿›è¡Œæ’é™¤ã€‚
4. é¿å…é˜»å¡ï¼šåœ¨æµ‹é‡é¡µé¢åŠ è½½æ—¶é—´æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½é¿å…é˜»å¡å…¶ä»–æ“ä½œï¼Œä»¥ä¾¿å¾—åˆ°æ›´å‡†ç¡®çš„ç»“æœã€‚å¯ä»¥ä½¿ç”¨å¼‚æ­¥åŠ è½½ç­‰æŠ€æœ¯æ¥å‡å°‘é˜»å¡æ—¶é—´ã€‚
5. æ…ç”¨åŒæ­¥è·å–ï¼šåœ¨è·å– `performance.timing` çš„æ•°æ®æ—¶ï¼Œéœ€è¦æ³¨æ„è¿™äº›æ•°æ®å¯èƒ½æ˜¯å¼‚æ­¥è·å–çš„ã€‚å¦‚æœåœ¨è·å–æ•°æ®ä¹‹å‰å°è¯•åŒæ­¥è®¿é—®è¿™äº›å±æ€§ï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚å› æ­¤ï¼Œéœ€è¦ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼è·å– `performance.timing` çš„æ•°æ®ã€‚

### 3. Navigation Timing æ¥å£

`PerformanceNavigationTiming` æ¥å£ç»§æ‰¿è‡ª `PerformanceResourceTiming` æ¥å£ï¼Œå®ƒæä¾›äº†æœ‰å…³ç½‘é¡µå¯¼èˆªæ€§èƒ½çš„æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚`PerformanceNavigationTiming` å¯¹è±¡æ˜¯é€šè¿‡ `performance.getEntriesByType('navigation')` æ–¹æ³•è·å–çš„ã€‚

`PerformanceNavigationTiming` æ¥å£æä¾›äº†ä»¥ä¸‹å±æ€§ï¼š

é€šè¿‡è¿™äº›å±æ€§ï¼Œæ‚¨å¯ä»¥è·å¾—æœ‰å…³é¡µé¢å¯¼èˆªè¿‡ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ DNS æŸ¥è¯¢ã€TCP è¿æ¥ã€SSL/TLS æ¡æ‰‹ã€HTTP è¯·æ±‚å’Œå“åº”ã€DOM è§£æå’Œæ¸²æŸ“ç­‰è¿‡ç¨‹çš„æ—¶é—´æˆ³ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥ç”¨äºåˆ†æå’Œä¼˜åŒ–é¡µé¢æ€§èƒ½ã€‚

- `unloadEventStart`ï¼šè¿”å›å‰ä¸€ä¸ªé¡µé¢çš„ `unload` äº‹ä»¶å¼€å§‹çš„æ—¶é—´æˆ³ã€‚
- `unloadEventEnd`ï¼šè¿”å›å‰ä¸€ä¸ªé¡µé¢çš„ `unload` äº‹ä»¶ç»“æŸçš„æ—¶é—´æˆ³ã€‚
- `redirectStart`ï¼šè¿”å›é‡å®šå‘å¼€å§‹æ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰é‡å®šå‘å‘ç”Ÿï¼Œåˆ™è¿”å› 0ã€‚
- `redirectEnd`ï¼šè¿”å›é‡å®šå‘ç»“æŸæ—¶çš„æ—¶é—´æˆ³ã€‚å¦‚æœæ²¡æœ‰é‡å®šå‘å‘ç”Ÿï¼Œåˆ™è¿”å› 0ã€‚
- `fetchStart`ï¼šè¿”å›æµè§ˆå™¨å¼€å§‹æ£€ç´¢å½“å‰æ–‡æ¡£çš„æ—¶é—´æˆ³ã€‚
- `domainLookupStart`ï¼šè¿”å›æµè§ˆå™¨å¼€å§‹æ‰§è¡Œ DNS æŸ¥è¯¢çš„æ—¶é—´æˆ³ã€‚
- `domainLookupEnd`ï¼šè¿”å›æµè§ˆå™¨å®Œæˆ DNS æŸ¥è¯¢çš„æ—¶é—´æˆ³ã€‚
- `connectStart`ï¼šè¿”å›æµè§ˆå™¨å¼€å§‹è¿æ¥åˆ°æœåŠ¡å™¨çš„æ—¶é—´æˆ³ã€‚
- `connectEnd`ï¼šè¿”å›æµè§ˆå™¨å®Œæˆè¿æ¥åˆ°æœåŠ¡å™¨çš„æ—¶é—´æˆ³ã€‚
- `secureConnectionStart`ï¼šè¿”å›æµè§ˆå™¨å¼€å§‹å®‰å…¨è¿æ¥æ¡æ‰‹çš„æ—¶é—´æˆ³ã€‚å¦‚æœå½“å‰æ–‡æ¡£ä¸æ˜¯é€šè¿‡å®‰å…¨è¿æ¥åŠ è½½çš„ï¼Œåˆ™è¿”å› 0ã€‚
- `requestStart`ï¼šè¿”å›æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶é—´æˆ³ã€‚
- `responseStart`ï¼šè¿”å›æµè§ˆå™¨ä»æœåŠ¡å™¨æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´æˆ³ã€‚
- `responseEnd`ï¼šè¿”å›æµè§ˆå™¨ä»æœåŠ¡å™¨æ¥æ”¶åˆ°æœ€åä¸€ä¸ªå­—èŠ‚çš„æ—¶é—´æˆ³ã€‚
- `domLoading`ï¼šè¿”å›æµè§ˆå™¨å¼€å§‹è§£ææ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM) çš„æ—¶é—´æˆ³ã€‚
- `domInteractive`ï¼šè¿”å›æµè§ˆå™¨å®Œæˆè§£æå¹¶ç”Ÿæˆ DOM æ ‘çš„æ—¶é—´æˆ³ã€‚
- `domContentLoadedEventStart`ï¼šè¿”å› DOMContentLoaded äº‹ä»¶å¼€å§‹çš„æ—¶é—´æˆ³ã€‚
- `domContentLoadedEventEnd`ï¼šè¿”å› DOMContentLoaded äº‹ä»¶ç»“æŸçš„æ—¶é—´æˆ³ã€‚
- `domComplete`ï¼šè¿”å›æµè§ˆå™¨å®ŒæˆåŠ è½½æ‰€æœ‰å­èµ„æºçš„æ—¶é—´æˆ³ã€‚
- `loadEventStart`ï¼šè¿”å› load äº‹ä»¶å¼€å§‹çš„æ—¶é—´æˆ³ã€‚
- `loadEventEnd`ï¼šè¿”å› load äº‹ä»¶ç»“æŸçš„æ—¶é—´æˆ³ã€‚

### 4. PerformanceEntry å¯¹è±¡

åœ¨ Performance API ä¸­ï¼Œ`PerformanceEntry` å¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ªæ€§èƒ½æ¡ç›®ï¼Œå®ƒåŒ…å«äº†æœ‰å…³æŸä¸ªç‰¹å®šçš„æµ‹é‡å¯¹è±¡ï¼ˆå¦‚é¡µé¢ã€èµ„æºã€äº‹ä»¶ç­‰ï¼‰çš„ä¿¡æ¯ã€‚

`PerformanceEntry` å¯¹è±¡æœ¬èº«åªæ˜¯ä¸€ä¸ªç”¨äºæè¿°æŸä¸ªæ€§èƒ½æ¡ç›®ï¼ˆå¦‚èµ„æºåŠ è½½ã€é¡µé¢å¯¼èˆªç­‰ï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒå­˜å‚¨äº†è¯¥æ€§èƒ½æ¡ç›®çš„å„é¡¹æ€§èƒ½æ•°æ®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æä¾›å®é™…çš„æ€§èƒ½åˆ†æå·¥å…·æˆ–æ–¹æ³•ã€‚å› æ­¤ï¼Œ`PerformanceEntry` å¯¹è±¡ä»…ä»…æ˜¯ä¸€ä¸ªä¸­é—´æ•°æ®æ ¼å¼ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚æˆ‘ä»¬é€šå¸¸éœ€è¦å°†æ”¶é›†åˆ°çš„ `PerformanceEntry` å¯¹è±¡ä¼ é€’ç»™å…¶ä»–æ€§èƒ½åˆ†æå·¥å…·ï¼Œå¦‚ `PerformanceObserver` æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹æ€§èƒ½ç›‘æµ‹åº“ï¼Œæ‰å¯ä»¥å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†å’Œä¼˜åŒ–ã€‚

æ¯ä¸ª `PerformanceEntry` å¯¹è±¡éƒ½åŒ…å«äº†ä»¥ä¸‹å…±åŒå±æ€§ï¼š

- `name`ï¼šè¡¨ç¤ºè¯¥æ¡ç›®çš„åç§°ï¼›
- `entryType`ï¼šè¡¨ç¤ºè¯¥æ¡ç›®çš„ç±»å‹ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ "navigation"ã€"resource" æˆ– "measure"ï¼›
- `startTime`ï¼šè¡¨ç¤ºè¯¥æ¡ç›®çš„èµ·å§‹æ—¶é—´æˆ³ï¼›
- `duration`ï¼šè¡¨ç¤ºè¯¥æ¡ç›®æŒç»­çš„æ—¶é—´ã€‚

```ts
[Exposed=(Window,Worker)]
interface PerformanceEntry {
  readonly    attribute DOMString           name;
  readonly    attribute DOMString           entryType;
  readonly    attribute DOMHighResTimeStamp startTime;
  readonly    attribute DOMHighResTimeStamp duration;
  [Default] object toJSON();
};
```

åŸºäºä¸åŒçš„ç±»å‹ï¼Œ`PerformanceEntry` å¯¹è±¡è¿˜å¯èƒ½åŒ…å«å…¶ä»–ç‰¹å®šçš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯¹äº `Resource Timing` æ¥è¯´ï¼Œ`PerformanceEntry` å¯¹è±¡åŒ…æ‹¬äº†ä»¥ä¸‹é¢å¤–çš„å±æ€§ï¼š

- `initiatorType`ï¼šè¡¨ç¤ºå‘èµ·è¯¥èµ„æºè¯·æ±‚çš„ç±»å‹ï¼Œä¾‹å¦‚ "img"ã€"script" ç­‰ï¼›
- `nextHopProtocol`ï¼šè¡¨ç¤ºè¯¥èµ„æºçš„ä¼ è¾“åè®®ï¼Œä¾‹å¦‚ "http/1.1"ã€"h2" ç­‰ï¼›
- `encodedBodySize`ï¼šè¡¨ç¤ºè¯¥èµ„æºçš„ç¼–ç åå¤§å°ï¼›
- `decodedBodySize`ï¼šè¡¨ç¤ºè¯¥èµ„æºçš„è§£ç åå¤§å°ï¼›
- `transferSize`ï¼šè¡¨ç¤ºè¯¥èµ„æºçš„ä¼ è¾“å¤§å°ã€‚

### 5. PerformanceObserver å¯¹è±¡

`PerformanceObserver` æ˜¯ä¸€ä¸ªç”¨äºç›‘å¬å’Œæ”¶é›† Web åº”ç”¨ç¨‹åºæ€§èƒ½æ•°æ®çš„æ¥å£ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•ä½†æœ‰æ•ˆçš„æ–¹æ³•æ¥è·å–å„ç§æ€§èƒ½æ¡ç›®çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶åœ¨æŒ‡å®šæ¡ä»¶æ»¡è¶³æ—¶å‘é€é€šçŸ¥ã€‚é€šè¿‡ `PerformanceObserver` æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å®æ—¶ç›‘æµ‹åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¡¨ç°ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†æå’Œä¼˜åŒ–ã€‚

`PerformanceObserver` æ¥å£æä¾›äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„æ–¹æ³•ï¼š

- `PerformanceObserver.observe()`: ç”¨äºå¯åŠ¨ `PerformanceObserver` å®ä¾‹ï¼Œå¹¶è®¾ç½®å®ƒè¦ç›‘å¬çš„æŒ‡å®šç±»å‹çš„æ€§èƒ½æ¡ç›®ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé…ç½®å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå…¶ä¸­åŒ…æ‹¬è¦ç›‘å¬çš„æ€§èƒ½æ¡ç›®ç±»å‹ã€å›è°ƒå‡½æ•°ç­‰ã€‚
- `PerformanceObserver.disconnect()`: ç”¨äºåœæ­¢ `PerformanceObserver` å®ä¾‹çš„ç›‘å¬æ“ä½œï¼Œå¹¶é‡Šæ”¾å…¶ä¸­çš„èµ„æºã€‚
- `PerformanceObserver.takeRecords()`: ç”¨äºè·å–å½“å‰å·²ç»è¢«æ”¶é›†åˆ°çš„æ‰€æœ‰æ€§èƒ½æ¡ç›®ï¼Œå¹¶æ¸…ç©ºåŸæœ‰çš„è®°å½•ç¼“å­˜ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª `PerformanceEntryList` å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰è¢«æ”¶é›†åˆ°çš„æ€§èƒ½æ¡ç›®ã€‚

https://codepen.io/linhaishe/pen/MWqNQOJ?editors=0111

## 3. è®¡ç®—æ€§èƒ½æŒ‡æ ‡

### a. è®¡ç®—é¡µé¢åŠ è½½æ—¶é—´

é€šè¿‡è®¡ç®—`loadEventEnd`å’Œ`navigationStart`çš„æ—¶é—´æˆ³ä¹‹å·®ï¼Œå¯ä»¥å¾—å‡ºé¡µé¢çš„åŠ è½½æ—¶é—´ã€‚

è¿™ä¸ªæ—¶é—´åŒ…æ‹¬äº†æ‰€æœ‰çš„èµ„æºåŠ è½½æ—¶é—´å’ŒDOMæ“ä½œæ—¶é—´ã€‚

```js
var pageLoadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
console.log('é¡µé¢åŠ è½½æ—¶é—´ä¸ºï¼š' + pageLoadTime + ' æ¯«ç§’');
```

https://codepen.io/linhaishe/pen/BaOXaGw?editors=0011

ä¾‹å­çš„loadEventEndè·‘å‡ºæ¥æ˜¯0ï¼Ÿï¼Ÿï¼Ÿ

**`PerformanceTiming.loadEventEnd`** æ˜¯ä¸€ä¸ªè¿”å›ä»£è¡¨ä¸€ä¸ªæ—¶åˆ»çš„ `unsigned long long` å‹åªè¯»å±æ€§ï¼Œä¸º [`load`](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/load_event) äº‹ä»¶å¤„ç†ç¨‹åºè¢«ç»ˆæ­¢ï¼ŒåŠ è½½äº‹ä»¶å·²ç»å®Œæˆä¹‹æ—¶çš„ Unix æ¯«ç§’æ—¶é—´æˆ³ã€‚å¦‚æœè¿™ä¸ªäº‹ä»¶æ²¡æœ‰è¢«è§¦å‘ï¼Œæˆ–è€…æ²¡èƒ½å®Œæˆï¼Œåˆ™è¯¥å€¼å°†ä¼šè¿”å› `0`ã€‚

### b. ä¼˜åŒ–DOMæ“ä½œ

é€šè¿‡è®¡ç®—`domContentLoadedEventEnd`å’Œ`domContentLoadedEventStart`çš„æ—¶é—´æˆ³ä¹‹å·®ï¼Œå¯ä»¥å¾—å‡ºDOMæ“ä½œçš„æ—¶é—´ã€‚

å¯ä»¥æ ¹æ®DOMæ“ä½œçš„æ—¶é—´æ¥ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘DOMæ“ä½œçš„æ¬¡æ•°æˆ–ä½¿ç”¨æ›´é«˜æ•ˆçš„æ“ä½œæ–¹æ³•ï¼Œä»¥æé«˜é¡µé¢æ€§èƒ½ã€‚

```js
var domLoadingTime = performance.timing.domContentLoadedEventEnd - performance.timing.domContentLoadedEventStart;
console.log('DOMæ“ä½œæ—¶é—´ä¸ºï¼š' + domLoadingTime + ' æ¯«ç§’');
```

https://codepen.io/linhaishe/pen/OJoKJvm?editors=1112

### c. è®¡ç®—èµ„æºåŠ è½½æ—¶é—´

é€šè¿‡è®¡ç®—`responseEnd`å’Œ`fetchStart`çš„æ—¶é—´æˆ³ä¹‹å·®ï¼Œå¯ä»¥å¾—å‡ºèµ„æºåŠ è½½æ—¶é—´ã€‚

å¯ä»¥æ ¹æ®èµ„æºåŠ è½½çš„æ—¶é—´æ¥è°ƒæ•´èµ„æºçš„åŠ è½½é¡ºåºå’Œä½¿ç”¨æ–¹æ³•ï¼Œä»¥æé«˜é¡µé¢æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

```js
var resourceLoadTime = performance.timing.responseEnd - performance.timing.fetchStart;
console.log('èµ„æºåŠ è½½æ—¶é—´ä¸ºï¼š' + resourceLoadTime + ' æ¯«ç§’');
```

https://codepen.io/linhaishe/pen/zYJgEmR?editors=0011













## å…¶ä»–å†…å®¹

Performance APIï¼ˆæ€§èƒ½APIï¼‰æ˜¯ä¸€ç§Web APIï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜æµ‹é‡å’Œåˆ†æWebåº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å®ƒæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„Webå¹³å°APIçš„ä¸€éƒ¨åˆ†ã€‚

é€šè¿‡Performance APIï¼Œå¼€å‘äººå‘˜å¯ä»¥æµ‹é‡Webåº”ç”¨ç¨‹åºçš„å„ä¸ªæ–¹é¢çš„æ€§èƒ½ï¼Œä¾‹å¦‚åŠ è½½æ—¶é—´ã€å“åº”æ—¶é—´ã€èµ„æºä½¿ç”¨æƒ…å†µç­‰ç­‰ã€‚Performance APIæä¾›äº†å„ç§æ–¹æ³•å’ŒæŒ‡æ ‡ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥è¯†åˆ«å’Œè§£å†³æ€§èƒ½ç“¶é¢ˆå’Œé—®é¢˜ï¼Œå¹¶æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

ä¸€äº›å¸¸ç”¨çš„Performance APIæ–¹æ³•å’ŒæŒ‡æ ‡åŒ…æ‹¬ï¼š

- performance.timingï¼šæµ‹é‡é¡µé¢åŠ è½½å’Œå„ç§äº‹ä»¶çš„æ—¶é—´ã€‚
- performance.now()ï¼šæä¾›é«˜ç²¾åº¦çš„æ—¶é—´æˆ³ï¼Œç”¨äºæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ã€‚
- performance.mark()å’Œperformance.measure()ï¼šå…è®¸å¼€å‘äººå‘˜æ ‡è®°å’Œæµ‹é‡åº”ç”¨ç¨‹åºä¸­çš„ç‰¹å®šæ—¶é—´é—´éš”ã€‚
- PerformanceObserver APIï¼šæä¾›äº†ä¸€ç§æ–¹æ³•æ¥ç›‘è§†æ€§èƒ½æŒ‡æ ‡å¹¶åœ¨è¾¾åˆ°ç‰¹å®šé˜ˆå€¼æ—¶è§¦å‘é€šçŸ¥ã€‚

## 

æµ‹é‡é¡µé¢åŠ è½½å’Œå„ç§äº‹ä»¶çš„æ—¶é—´

1. æ£€æµ‹é¡µé¢åŠ è½½æ—¶é—´ï¼šä½¿ç”¨Navigation Timing APIè·å–é¡µé¢å¼€å§‹åŠ è½½å’Œé¡µé¢å®ŒæˆåŠ è½½çš„æ—¶é—´ï¼Œè®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å€¼ï¼Œå³å¯å¾—åˆ°é¡µé¢åŠ è½½æ—¶é—´ã€‚å¯ä»¥ä½¿ç”¨æ­¤ä¿¡æ¯æ¥ç¡®å®šå“ªäº›èµ„æºåŠ è½½ç¼“æ…¢ï¼Œå¹¶å°è¯•ä¼˜åŒ–å®ƒä»¬ã€‚

   ```js
   var pageLoadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
   console.log('Page load time: ' + pageLoadTime + 'ms');
   ```

2. ç›‘æµ‹èµ„æºåŠ è½½æ—¶é—´ï¼šä½¿ç”¨Resource Timing APIè·å–æ¯ä¸ªèµ„æºçš„åŠ è½½æ—¶é—´ï¼Œå¹¶ä½¿ç”¨æ­¤ä¿¡æ¯æ¥ä¼˜åŒ–èµ„æºçš„å¤§å°ã€ç¼“å­˜ç­–ç•¥å’ŒæœåŠ¡å™¨å“åº”æ—¶é—´ã€‚å¯ä»¥ç›‘æ§æ¯ä¸ªèµ„æºï¼ˆä¾‹å¦‚å›¾åƒã€CSSæ–‡ä»¶å’ŒJavaScriptæ–‡ä»¶ï¼‰çš„åŠ è½½æ—¶é—´ï¼Œå¹¶è¯†åˆ«åŠ è½½æ—¶é—´è¾ƒé•¿çš„èµ„æºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨`performance.getEntriesByType('resource')`æ–¹æ³•è·å–æ‰€æœ‰èµ„æºçš„è¯¦ç»†è®¡æ—¶ä¿¡æ¯

   ```js
   var resources = performance.getEntriesByType('resource');
   resources.forEach(function(resource) {
     console.log(resource.name + ' load time: ' + resource.duration + 'ms');
   });
   ```

3. æ£€æµ‹ç”¨æˆ·æ“ä½œå“åº”æ—¶é—´ï¼šä½¿ç”¨User Timing APIåˆ›å»ºè‡ªå®šä¹‰æ€§èƒ½åº¦é‡æ ‡å‡†ï¼Œä¾‹å¦‚æ ‡è®°ç‰¹å®šä»£ç å—çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å€¼ï¼Œä»¥ç¡®å®šç”¨æˆ·æ“ä½œçš„å“åº”æ—¶é—´ã€‚

4. åˆ†æä»£ç æ€§èƒ½ï¼šä½¿ç”¨User Timing APIåˆ›å»ºæ€§èƒ½åº¦é‡æ ‡å‡†ï¼Œä¾‹å¦‚æ ‡è®°ä»£ç å—çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œå¹¶è®°å½•è¿™äº›æ ‡è®°çš„æ—¶é—´æˆ³ï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ·±å…¥çš„åˆ†æã€‚

   ```js
   performance.mark('start');
   // æ‰§è¡Œä¸€äº›ä»£ç å—
   performance.mark('end');
   performance.measure('Code block execution time', 'start', 'end');
   var measure = performance.getEntriesByName('Code block execution time')[0];
   console.log('Code block execution time: ' + measure.duration + 'ms');
   ```

5. ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ï¼šä½¿ç”¨High Resolution Time APIè·å–é«˜åˆ†è¾¨ç‡çš„æ—¶é—´æˆ³ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ¥åˆ›å»ºå¹³æ»‘çš„åŠ¨ç”»æ•ˆæœï¼Œé¿å…è§†è§‰æŠ–åŠ¨å’Œå¡é¡¿ã€‚

   ```js
   const t0 = performance.now();
   
   // æ‰§è¡Œä¸€äº›è€—æ—¶çš„ä»£ç 
   
   const t1 = performance.now();
   console.log(`æ‰§è¡Œè€—æ—¶ä¸º ${t1 - t0} æ¯«ç§’`);
   ```

6. åˆ†æäº‹ä»¶æ€§èƒ½ï¼šä½¿ç”¨Performance Timeline APIè·å–æœ‰å…³æµè§ˆå™¨äº‹ä»¶ï¼ˆä¾‹å¦‚JavaScriptæ‰§è¡Œã€CSSè§£æã€é‡ç»˜ç­‰ï¼‰çš„è¯¦ç»†è®¡æ—¶ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨æ­¤ä¿¡æ¯æ¥è¯Šæ–­æ€§èƒ½é—®é¢˜ã€‚

   Performance Timeline API åŒ…æ‹¬å¤šä¸ªç›¸å…³çš„æ¥å£ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š

   1. PerformanceEntry æ¥å£ï¼šä»£è¡¨äº†ä¸€ä¸ªæ€§èƒ½è®°å½•æ¡ç›®ï¼Œå…¶ä¸­åŒ…å«äº†æŸä¸ªæ€§èƒ½äº‹ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚åç§°ã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ç­‰ã€‚

   2. PerformanceObserver æ¥å£ï¼šç”¨äºè§‚å¯Ÿæ€§èƒ½æ¡ç›®çš„å˜åŒ–ï¼Œå½“æœ‰æ–°çš„æ€§èƒ½æ¡ç›®è¢«æ·»åŠ æ—¶ï¼Œå¯ä»¥æ”¶åˆ°é€šçŸ¥å¹¶è¿›è¡Œå¤„ç†ã€‚

   3. Performance å¯¹è±¡ï¼šä»£è¡¨äº†å½“å‰é¡µé¢çš„æ€§èƒ½ä¿¡æ¯ï¼ŒåŒ…å«äº†å„ç§æ€§èƒ½æŒ‡æ ‡ï¼Œæ¯”å¦‚é¡µé¢åŠ è½½æ—¶é—´ã€èµ„æºåŠ è½½æ—¶é—´ã€å“åº”æ—¶é—´ç­‰ã€‚

      ```js
      const observer = new PerformanceObserver((list) => {
        const entries = list.getEntries();
        for (const entry of entries) {
          if (entry instanceof PerformanceResourceTiming) {
            console.log(`èµ„æº ${entry.name} çš„åŠ è½½æ—¶é—´ä¸º ${entry.duration} æ¯«ç§’`);
          }
        }
      });
      
      observer.observe({ entryTypes: ["resource"] });
      
      ```

      Performance Timeline API å¯èƒ½ä¼šå½±å“æµè§ˆå™¨çš„æ€§èƒ½ï¼Œå› æ­¤åœ¨ä½¿ç”¨æ—¶åº”è¯¥è°¨æ…ã€‚å¦‚æœåªéœ€è¦è·å–ç®€å•çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Performance å¯¹è±¡æä¾›çš„æ–¹æ³•ï¼Œæ¯”å¦‚ `performance.timing`ã€`performance.navigation` ç­‰ã€‚

