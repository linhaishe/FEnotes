### è®¾è®¡æ¨¡å¼


#### ç®€ä»‹

è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨çš„ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚

**Design Patterns - Elements of Reusable Object-Oriented Software**

**ä¸­æ–‡è¯‘åï¼šè®¾è®¡æ¨¡å¼ - å¯å¤ç”¨çš„é¢å‘å¯¹è±¡è½¯ä»¶å…ƒç´ **

åŸºäºä»¥ä¸‹çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™

- å¯¹æ¥å£ç¼–ç¨‹è€Œä¸æ˜¯å¯¹å®ç°ç¼–ç¨‹ã€‚
- ä¼˜å…ˆä½¿ç”¨å¯¹è±¡ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ã€‚

#### ç›¸å…³é“¾æ¥

[RUNOOBå¯¹è®¾è®¡æ¨¡å¼çš„è®²è§£(java)](https://www.runoob.com/design-pattern/design-pattern-intro.html)ğŸŒŸ

[JavaScript Design Patterns: The Singleton](https://www.sitepoint.com/javascript-design-patterns-singleton/)ğŸŒŸ

 ### å•ä¾‹æ¨¡å¼

#### ç›¸å…³é“¾æ¥

[JavaScript Design Patterns: Singleton](https://robdodson.me/javascript-design-patterns-singleton/)ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

[jså•ä¾‹æ¨¡å¼](https://segmentfault.com/a/1190000012842251)ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

#### ç®€ä»‹

**Ensure a class has only one instance and provide a global point of access to it.**

è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚

è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚

**æ„å›¾ï¼š**ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚

**ä¸»è¦è§£å†³ï¼š**ä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»é¢‘ç¹åœ°åˆ›å»ºä¸é”€æ¯ã€‚

**ä½•æ—¶ä½¿ç”¨ï¼š**å½“æ‚¨æƒ³æ§åˆ¶å®ä¾‹æ•°ç›®ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºçš„æ—¶å€™ã€‚

**å¦‚ä½•è§£å†³ï¼š**åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰è¿™ä¸ªå•ä¾‹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºã€‚

**å…³é”®ä»£ç ï¼š**æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚

#### æ³¨æ„ç‚¹

- 1ã€å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚
- 2ã€å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚
- 3ã€å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚

å®ç°çš„æ€è·¯

å…ˆåˆ¤æ–­è¿™ä¸ªå®ä¾‹æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›å®ä¾‹ï¼Œå¼€å§‹å·¥ä½œï¼›å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œå†è¿”å›ã€‚è¿™æ ·å°±ä¿è¯äº†ä¸€ä¸ªç±»ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚

å•ä¾‹æ¨¡å¼ï¼Œå®ƒæ›´å¤šçš„æ˜¯åšä¸ºä¸€ä¸ªå‘½åç©ºé—´çš„æ¦‚å¿µï¼Œä»å…¨å±€å‘½åç©ºé—´é‡Œæä¾›ä¸€ä¸ªå”¯ä¸€çš„è®¿é—®çš„å…¥å£ã€‚

#### æœ€ç®€å•çš„ä¸€ä¸ªå•ä¾‹æ¨¡å¼

å¯¹è±¡å­—é¢é‡,æœ€ç®€å•çš„å°±æ˜¯å¯¹è±¡å­—é¢é‡ï¼Œå®ƒé‡Œé¢å¯ä»¥æœ‰å¤§é‡çš„å±æ€§ã€æ–¹æ³•ã€‚å› ä¸ºå¯¹è±¡æ˜¯æŒ‰å¼•ç”¨è®¿é—®çš„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªjsé‡Œï¼Œæœ‰ä¸”åªæœ‰å®ƒä¸€ä¸ªã€‚functionæ–¹æ³•çš„ç”¨é€”æ˜¯ï¼Œå½¢æˆä¸€ä¸ªå•ç‹¬çš„ä½œç”¨åŸŸã€‚åŒæ ·çš„ä¸œè¥¿ï¼Œä¸åŒçš„å«æ³•ã€‚

```js
var user = {
  firstName :'',
  lastName : '',
  sayName:function(){
    return this.firstName + ''+ this.lastName;
  }
}
```

#### object literals or create constructor functions

```javascript
var NAMESPACE = {};

NAMESPACE.login = function() {
	// do some login shtuffs
}

NAMESPACE.logout = function() {
	// do some logout shtuffs
}

NAMESPACE.addToCart = function() {
	// blah, blah blah...
}

NAMESPACE.Widget = function(foo, bar) {
	// Some awesome widget code
}

NAMESPACE.Widget.prototype.doSomethingAwesome = function() {
	// do something awesome!!!
}

var myWidget = new NAMESPACE.Widget('hello', 'world');
```

#### Singleton with a cached static property

```javascript
function User() {
	// do we have an existing instance?
	if (typeof User.instance === 'object') {
		return User.instance;
	}
	
	// proceed as normal
	this.firstName = 'John';
	this.lastName = 'Doe';
	
	// cache
	User.instance = this;
	
	// implicit return
	// return this;
}
```

#### Singleton with a closure

[é—­åŒ…å®ç°å•ä¾‹æ¨¡å¼,æ˜é‡‘,çœ‹è§£æå›¾](https://juejin.im/post/5bb86cdbe51d450e4438042c)ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ

### ç†è§£æ—¶å®¹æ˜“æ··æ·†çš„ç‚¹

1. å¯¹è±¡çš„å®ä¾‹ä¸­constructorå±æ€§åº”è¯¥æŒ‡å‘åˆ›é€ çš„å¯¹è±¡ï¼ˆå³ç”Ÿå‡ºå¥¹ä»¬çš„çˆ¶æ¯ï¼‰
2. æ„é€ å‡½æ•°thisæŒ‡å‘è°ƒç”¨è€…å¾€å¾€æ˜¯è°ƒç”¨æ„é€ å‡½æ•°çš„å®ä¾‹æœ¬èº«
3. å…¨å±€å‡½æ•°ä¸­this = window,å‡½æ•°è¢«ä½œä¸ºæŸä¸ªå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œthisç­‰äºé‚£ä¸ªå¯¹è±¡ã€‚åŒ¿åå‡½æ•°çš„æ‰§è¡Œç¯å¢ƒå…·æœ‰å…¨å±€æ€§ï¼Œå…¶thisé€šå¸¸æŒ‡å‘windows

```javascript
function User() {
	// the cached instance
	var instance;

	// rewrite the constructor
	User = function() {
		return instance;
	};

	// carry over the prototype
	User.prototype = this;

	// the instance
	instance = new User();

	// reset the constructor pointer
	instance.constructor = User;

	// all the functionality
	instance.firstName = 'John';
	instance.lastName = 'Doe';

	return instance;
}
```

#### Singleton with a self executing function

å¾…è¡¥å……


#### better way but more complex

å¾…è¡¥å……

```javascript
var Singleton = (function () {
    var instance;
 
    function createInstance() {
        var object = new Object("I am the instance");
        return object;
    }
 
    return {
      //getInstance method is Singleton's gatekeeper
        getInstance: function () {
          //Lazy Load
            if (!instance) {
                instance = createInstance();
            }
            return instance;
        }
    };
})();
 
function run() {
 
    var instance1 = Singleton.getInstance();
    var instance2 = Singleton.getInstance();
 
    alert("Same instance? " + (instance1 === instance2));  
}
```

----

è¦æ‰©å±•å¯¹è±¡ï¼Œè¦æ·»åŠ å±æ€§ã€æ–¹æ³•ï¼Œä½¿ç”¨é—­åŒ…åœ¨å†…éƒ¨å°è£…å®ƒä»¬ï¼Œç„¶åå¯¹å¤–æš´éœ²å…¬å¼€çš„æ–¹æ³•

```js
var _singleton = function(){
	// ç§æœ‰çš„å±æ€§
	var _prName = 'xxx123';
  //ç§æœ‰æ–¹æ³•
	function prFn(){
		console.log( _prName )
	}

	// å¯¹å¤–å…¬å¼€çš„æ–¹æ³•ï¼Œæ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œå¯¹è±¡é”®å€¼å¯¹ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ç§æœ‰æ–¹æ³•ã€‚ç›¸å½“äºä¸€ä¸ªæ¥å£
	return {
		publiceFn:function(){
			prFn();
		}
	}
}
//this.xx = prFn,æ˜¯å¯¹å¤–å…¬å¼€çš„æ–¹æ³•ï¼Œéœ€è¦newï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯ä¸€ä¸ªç±»ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥ä¸å¯ä»¥ç”¨

// è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…å«ç€å…¬å¼€æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ï¼Œå…¶å®å°±æ˜¯å…¨å±€ä½¿ç”¨çš„ï¼Œå•ä¾‹è¿™ä¸ªå¯¹è±¡

//_singleton().publiceFn()
//å°½é‡ä¸è¦è¿™æ ·å†™ï¼Œä¸€èˆ¬ä¼ è¾“åˆ°å˜é‡åä¸­

var _singObj = _singleton();

// è¿™è¡Œä»£ç ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ï¼Œ_singObjåœ¨ä»»ä½•æ—¶å€™éƒ½æ˜¯å”¯ä¸€çš„
_singObj.publiceFn();

```

åœ¨â€œéœ€è¦çš„æ—¶å€™ï¼Œæ‰åˆå§‹åŒ–ä¸€ä¸ªå•ä¾‹å‡ºæ¥â€ï¼Œè¿™æ˜¯ä¸ºäº†èŠ‚çº¦èµ„æºã€‚ä¸ç„¶ä½ ä¸€å¼€å§‹å°±æäº†ä¸€å¤§å †å…¨å±€çš„å¯¹è±¡å‡ºæ¥ï¼Œé‚£å¤ªå ç”¨èµ„æºäº†ã€‚

è¿™ä¸ªdemoä¸­çš„å•ä¾‹å¯¹è±¡ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨thisï¼Œå°±ä¼šé€ æˆæ²¡æœ‰è‡ªå·±çš„å±æ€§ã€æ–¹æ³•ï¼Œåœ¨åŠŸèƒ½ä¸Šä¼šå—é™åˆ¶ã€‚

```js
var _singleton = (function () {
		// ç”¨æ¥è£…è½½å•ä¾‹çš„å®¹å™¨
		var _instanceObj = null;

		// åˆå§‹åŒ–ï¼Œå…·ä½“çš„å•ä¾‹çš„ä¸šåŠ¡ä»£ç 
		function initFn() {
			// å®šä¹‰ä¸€ä¸ªå•ä¾‹
			return {
				name: 'æˆ‘æ˜¯è€å°š',
				age: 'ä»Šå¹´18',
				say: function () {
					console.log('è¾“å‡ºsayæ–¹æ³•')
				}
			}
		}

		// å¯¹å¤–çš„å…¬å¼€æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æœ‰æ²¡æœ‰å®ä¾‹
		// è¿™æ˜¯é€»è¾‘ä»£ç ï¼Œè·Ÿå®é™…ä¸šåŠ¡æ— å…³
		return {
			getInstanceFn: function () {
				// è¿™é‡Œä¸ºä»€ä¹ˆåŠ !å‘¢ï¼Ÿ
				// å› ä¸º_instanceObjåˆå§‹æ˜¯ç©ºï¼Œè½¬ä¸ºbooleanä¸ºfalseï¼Œ
				// ä¼šè¿›ç¬¬äºŒä¸ªåˆ†æ”¯ï¼Œè¿™å°±æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™é‡Œå…¶å®åªéœ€è¦ä¸€ä¸ªåˆ†æ”¯ã€‚
				// æ‰€ä»¥ç”¨!å–åï¼Œåªå†™ä¸€ä¸ªifåˆ†æ”¯å°±å¯ä»¥äº†
        //å®ä¾‹éç©ºçš„è¯è¿›è¡Œè¿”å›
				if (!_instanceObj) {
					_instanceObj = initFn()
				}

				return _instanceObj;
			}
		}
	})();

	console.log(_singleton)
	console.log(_singleton.getInstanceFn())
```

```js
var _singleton = (function(){
	// ç”¨æ¥è£…è½½å•ä¾‹çš„å®¹å™¨
	var _instanceObj = null;

	// åˆå§‹åŒ–ï¼Œå…·ä½“çš„å•ä¾‹çš„ä¸šåŠ¡ä»£ç ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªæ„é€ å™¨
	// ä¼ å€¼ç¬¬4æ­¥
	function initFn(args){
		// å®šä¹‰ä¸€ä¸ªå•ä¾‹
		// console.log(args)
//??????????????????
		// ç»™thisï¼ŒåŠ¨æ€æ‰¹é‡æ·»åŠ å±æ€§
		for(var i in args){
			// console.log(args[i])
			this[i] = args[i]
		}

	}

	// å¯¹å¤–çš„å…¬å¼€æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æœ‰æ²¡æœ‰å®ä¾‹
	return {
		// ä¼ å€¼ç¬¬2æ­¥
		getInstanceFn:function(args){
			// console.log( args )

			if( !_instanceObj ){
				// ä¼ å€¼ç¬¬3æ­¥
				_instanceObj = new initFn(args)
			}

			return _instanceObj;
		}
	}
})();

// è·å¾—å•ä¾‹ï¼Œä¼ å€¼ç¬¬ä¸€æ­¥
var _obj = _singleton.getInstanceFn({
	name:'æˆ‘æ˜¯è€å°š',
	age:'ä»Šå¹´18å²'
});

// å·²ç»æœ‰äº†objï¼Œç„¶åè¿™ä¸ªobj2ï¼Œå°±ä¸ä¼šå†åˆå§‹åŒ–äº†
var _obj2 = _singleton.getInstanceFn({
	name:'111',
```